{% extends "base.html" %}

{% block title %}Accounts - Boglefolio{% endblock %}

{% block content %}
<header>
    <h3><i>account_balance_wallet</i> Accounts</h3>
    <button data-ui="#add-account-modal">
        <i>add</i>
        <span>Add Account</span>
    </button>
</header>

<div id="accounts-table">
    {% if accounts %}
    <div class="responsive">
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>User</th>
                    <th>Balance</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for account in accounts %}
                <tr>
                    <td>{{ account.name or 'Unnamed' }}</td>
                    <td>
                        {% if account.user %}
                            {{ account.user.username }}
                            {% if account.user.email %}<br><small>{{ account.user.email }}</small>{% endif %}
                        {% else %}
                            Unknown User
                        {% endif %}
                    </td>
                    <td>${{ "%.2f"|format(account.balance or 0) }}</td>
                    <td>
                        <button class="small">
                            <i>edit</i>
                        </button>
                        <button class="small">
                            <i>delete</i>
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <article class="center-align">
        <i>account_balance_wallet</i>
        <h5>No accounts yet</h5>
        <p>Add your first investment account to start tracking transactions.</p>
        {% if not users %}
        <p><em>Note: You need users before creating accounts.</em></p>
        <a href="/users">
            <i>people</i>
            <span>Add Users First</span>
        </a>
        {% else %}
        <button data-ui="#add-account-modal">
            <i>add</i>
            <span>Add Account</span>
        </button>
        {% endif %}
    </article>
    {% endif %}
</div>

<!-- Add Account Modal -->
<dialog id="add-account-modal">
    <h5>Add New Account</h5>
    <form hx-post="/accounts" hx-target="#accounts-table" hx-swap="outerHTML">
        <div class="field label border">
            <input type="text" name="name">
            <label>Account Name</label>
        </div>
        
        <div class="field label suffix border">
            <select name="user_id" required>
                <option value="">Select a user...</option>
                {% for user in users %}
                <option value="{{ user.id }}">{{ user.username }}{% if user.email %} ({{ user.email }}){% endif %}</option>
                {% endfor %}
            </select>
            <label>User</label>
            <i>keyboard_arrow_down</i>
        </div>
        
        <div class="field label prefix border">
            <i>attach_money</i>
            <input type="number" name="balance" step="0.01" min="0" value="0.00">
            <label>Initial Balance</label>
        </div>
        
        <nav class="right-align">
            <button type="button" data-ui="#add-account-modal">Cancel</button>
            <button type="submit" {% if not users %}disabled{% endif %}>
                <i>add</i>
                <span>Add Account</span>
            </button>
        </nav>
    </form>
</dialog>
{% endblock %}